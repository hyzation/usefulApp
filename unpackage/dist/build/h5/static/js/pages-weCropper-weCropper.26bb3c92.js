(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-weCropper-weCropper"],{1216:function(t,e,r){"use strict";r.r(e);var n=r("6a51"),o=r("df36");for(var i in o)["default"].indexOf(i)<0&&function(t){r.d(e,t,(function(){return o[t]}))}(i);r("8188");var a=r("f0c5"),c=Object(a["a"])(o["default"],n["b"],n["c"],!1,null,"4b9d1e60",null,!1,n["a"],void 0);e["default"]=c.exports},"233a":function(t,e,r){"use strict";(function(t){r("7a82");var n=r("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o,i=n(r("a403")),a={data:function(){return{pageLoading:!1,WeCropper:null,width:300,height:500,cropperSets:{height:500,width:300,id:"bgCropper",targetId:"prevCropper",scale:2.5,zoom:8,cut:{x:0,y:0,width:200,height:200}},tmpFace:null}},onLoad:function(t){o=this;var e=uni.getSystemInfoSync();this.width=e.windowWidth,this.height=e.windowHeight,this.cropperSets.width=this.width,this.cropperSets.height=this.height,this.cropperSets.pixelRatio=e.pixelRatio,this.cropperSets.cut.x=(this.width-this.cropperSets.cut.width)/2,this.cropperSets.cut.y=(this.height-this.cropperSets.cut.height)/2,this.WeCropper=new i.default(this.cropperSets),this.tmpFace=t.tmpFace,this.WeCropper.pushOrign(this.tmpFace)},methods:{touchStart:function(t){this.WeCropper.touchStart(t)},touchMove:function(t){this.WeCropper.touchMove(t)},touchEnd:function(t){this.WeCropper.touchEnd(t)},saveImg:function(){if(null==this.tmpFace)return o.$refs.guiPage.openMessage("default","请选择图片",!0,1500),!1;o.pageLoading=!0,this.WeCropper.getCropperImage((function(e){e?(getApp().globalData.tempFilePath=e,uni.navigateBack({delta:1})):t("log","获取图片地址失败，请稍后重试"," at pages/weCropper/weCropper.vue:94"),o.pageLoading=!1}))}}};e.default=a}).call(this,r("0de9")["log"])},"2deb":function(t,e,r){var n=r("24fb");e=n(!1),e.push([t.i,'.gui-img-crop[data-v-4b9d1e60]{width:%?750?%;background:#fff url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOwwAADsMBx2+oZAAAAB90RVh0U29mdHdhcmUATWFjcm9tZWRpYSBGaXJld29ya3MgOLVo0ngAAAAWdEVYdENyZWF0aW9uIFRpbWUAMDkvMjIvMjBpulvaAAAAQ0lEQVRIie3VsQ0AIAwDQZth2H8eljET0JgGiXf/OilNLGmqXJLVtqMNbwcMDAwMDHyck/SxXb/U/04NDAwMDPw+vAGUagde2qkMXgAAAABJRU5ErkJggg==");height:100%;position:fixed;z-index:100;left:0;top:0}\n.gui-img-crop[data-v-4b9d1e60]{top:44px}\n.gui-cropper-wrapper[data-v-4b9d1e60]{overflow:hidden}.gui-cropper-btn[data-v-4b9d1e60]{width:%?300?%;height:%?70?%;line-height:%?70?%;border-radius:%?10?%;margin:%?30?%}',""]),t.exports=e},"4b29":function(t,e,r){var n=r("2deb");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var o=r("4f06").default;o("039b15ce",n,!0,{sourceMap:!1,shadowMode:!1})},"6a51":function(t,e,r){"use strict";r.d(e,"b",(function(){return o})),r.d(e,"c",(function(){return i})),r.d(e,"a",(function(){return n}));var n={guiPage:r("1d79").default},o=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("gui-page",{ref:"guiPage",attrs:{isLoading:t.pageLoading}},[r("v-uni-view",{attrs:{slot:"gBody"},slot:"gBody"},[r("v-uni-view",{staticClass:"gui-img-crop"},[r("v-uni-view",{staticClass:"gui-cropper-wrapper",style:{height:t.height+"px",width:t.width+"px"}},[r("v-uni-canvas",{staticClass:"gui-cropper-bg",style:{width:t.width+"px",height:t.height+"px"},attrs:{"canvas-id":"bgCropper",id:"bgCropper","disable-scroll":!0},on:{touchstart:function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart.apply(void 0,arguments)},touchmove:function(e){arguments[0]=e=t.$handleEvent(e),t.touchMove.apply(void 0,arguments)},touchend:function(e){arguments[0]=e=t.$handleEvent(e),t.touchEnd.apply(void 0,arguments)}}}),r("v-uni-canvas",{staticClass:"gui-cropper-prev",attrs:{"canvas-id":"prevCropper",id:"prevCropper","disable-scroll":!0}})],1),r("v-uni-view",{staticClass:"gui-flex gui-align-items-center gui-justify-content-center gui-fixed-lb wp100",staticStyle:{height:"50px"}},[r("v-uni-view",{staticClass:"f28 cFFFFFF fm bgFF4F00 gui-text-center gui-cropper-btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.saveImg.apply(void 0,arguments)}}},[t._v("确定")])],1)],1)],1)],1)},i=[]},8188:function(t,e,r){"use strict";var n=r("4b29"),o=r.n(n);o.a},a403:function(t,e,r){(function(n,o){var i,a,c=r("7037").default;r("fb6a"),r("d3b7"),r("1d1c"),r("7a82"),r("acd8"),r("c975"),r("99af"),r("d9e2"),r("d401"),r("ac1f"),r("5319"),r("00b4"),r("466d"),r("cb29"),r("159b"),r("b64b"),
/**
 * we-cropper v1.3.9
 * (c) 2020 dlhandsome
 * @license MIT
 */
function(n,o){"object"===c(e)&&"undefined"!==typeof t?t.exports=o():(i=o,a="function"===typeof i?i.call(e,r,e,t):i,void 0===a||(t.exports=a))}(0,(function(){"use strict";var t=void 0,e=["touchstarted","touchmoved","touchended"];function r(t){var r=[],n=arguments.length-1;while(n-- >0)r[n]=arguments[n+1];e.forEach((function(e,n){void 0!==r[n]&&(t[e]=r[n])}))}function i(){return t||(t=uni.getSystemInfoSync()),t}var a={},u=i(),s=u.pixelRatio,d={id:{default:"cropper",get:function(){return a.id},set:function(t){"string"!==typeof t&&n("error","id："+t+" is invalid"," at GraceUI5/js/WeCropper.js:56"),a.id=t}},width:{default:750,get:function(){return a.width},set:function(t){"number"!==typeof t&&n("error","width："+t+" is invalid"," at GraceUI5/js/WeCropper.js:68"),a.width=t}},height:{default:750,get:function(){return a.height},set:function(t){"number"!==typeof t&&n("error","height："+t+" is invalid"," at GraceUI5/js/WeCropper.js:80"),a.height=t}},pixelRatio:{default:s,get:function(){return a.pixelRatio},set:function(t){"number"!==typeof t&&n("error","pixelRatio："+t+" is invalid"," at GraceUI5/js/WeCropper.js:92"),a.pixelRatio=t}},scale:{default:2.5,get:function(){return a.scale},set:function(t){"number"!==typeof t&&n("error","scale："+t+" is invalid"," at GraceUI5/js/WeCropper.js:104"),a.scale=t}},zoom:{default:5,get:function(){return a.zoom},set:function(t){"number"!==typeof t?n("error","zoom："+t+" is invalid"," at GraceUI5/js/WeCropper.js:116"):(t<0||t>10)&&n("error","zoom should be ranged in 0 ~ 10"," at GraceUI5/js/WeCropper.js:118"),a.zoom=t}},src:{default:"",get:function(){return a.src},set:function(t){"string"!==typeof t&&n("error","src："+t+" is invalid"," at GraceUI5/js/WeCropper.js:130"),a.src=t}},cut:{default:{},get:function(){return a.cut},set:function(t){"object"!==c(t)&&n("error","cut："+t+" is invalid"," at GraceUI5/js/WeCropper.js:142"),a.cut=t}},boundStyle:{default:{},get:function(){return a.boundStyle},set:function(t){"object"!==c(t)&&n("error","boundStyle："+t+" is invalid"," at GraceUI5/js/WeCropper.js:154"),a.boundStyle=t}},onReady:{default:null,get:function(){return a.ready},set:function(t){a.ready=t}},onBeforeImageLoad:{default:null,get:function(){return a.beforeImageLoad},set:function(t){a.beforeImageLoad=t}},onImageLoad:{default:null,get:function(){return a.imageLoad},set:function(t){a.imageLoad=t}},onBeforeDraw:{default:null,get:function(){return a.beforeDraw},set:function(t){a.beforeDraw=t}}},h=i(),p=h.windowWidth;var f="undefined"!==typeof window?window:"undefined"!==typeof o?o:"undefined"!==typeof self?self:{};function l(t,e){return e={exports:{}},t(e,e.exports),e.exports}var g=l((function(t,e){e.isStr=function(t){return"string"===typeof t},e.isNum=function(t){return"number"===typeof t},e.isArr=Array.isArray,e.isUndef=function(t){return void 0===t},e.isTrue=function(t){return!0===t},e.isFalse=function(t){return!1===t},e.isFunc=function(t){return"function"===typeof t},e.isObj=e.isObject=function(t){return null!==t&&"object"===c(t)};var r=Object.prototype.toString;e.isPlainObject=function(t){return"[object Object]"===r.call(t)};var n=Object.prototype.hasOwnProperty;e.hasOwn=function(t,e){return n.call(t,e)},e.noop=function(t,e,r){},e.isValidArrayIndex=function(t){var e=parseFloat(String(t));return e>=0&&Math.floor(e)===e&&isFinite(t)}})),v=g.isFunc,w=g.isPlainObject,b=["ready","beforeImageLoad","beforeDraw","imageLoad"];function y(t){return function(e){var r=[],n=arguments.length-1;while(n-- >0)r[n]=arguments[n+1];return void 0===e&&(e={}),new Promise((function(n,o){e.success=function(t){n(t)},e.fail=function(t){o(t)},t.apply(void 0,[e].concat(r))}))}}function x(t,e){return void 0===e&&(e=!1),new Promise((function(r){t.draw(e,r)}))}var m=y(uni.getImageInfo),C=y(uni.canvasToTempFilePath),A=l((function(t,e){
/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */
(function(r){var n=e,o=t&&t.exports==n&&t,i="object"==c(f)&&f;i.global!==i&&i.window!==i||(r=i);var a=function(t){this.message=t};a.prototype=new Error,a.prototype.name="InvalidCharacterError";var u=function(t){throw new a(t)},s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=/[\t\n\f\r ]/g,h={encode:function(t){t=String(t),/[^\0-\xFF]/.test(t)&&u("The string to be encoded contains characters outside of the Latin1 range.");var e,r,n,o,i=t.length%3,a="",c=-1,d=t.length-i;while(++c<d)e=t.charCodeAt(c)<<16,r=t.charCodeAt(++c)<<8,n=t.charCodeAt(++c),o=e+r+n,a+=s.charAt(o>>18&63)+s.charAt(o>>12&63)+s.charAt(o>>6&63)+s.charAt(63&o);return 2==i?(e=t.charCodeAt(c)<<8,r=t.charCodeAt(++c),o=e+r,a+=s.charAt(o>>10)+s.charAt(o>>4&63)+s.charAt(o<<2&63)+"="):1==i&&(o=t.charCodeAt(c),a+=s.charAt(o>>2)+s.charAt(o<<4&63)+"=="),a},decode:function(t){t=String(t).replace(d,"");var e=t.length;e%4==0&&(t=t.replace(/==?$/,""),e=t.length),(e%4==1||/[^+a-zA-Z0-9/]/.test(t))&&u("Invalid character: the string to be decoded is not correctly encoded.");var r,n,o=0,i="",a=-1;while(++a<e)n=s.indexOf(t.charAt(a)),r=o%4?64*r+n:n,o++%4&&(i+=String.fromCharCode(255&r>>(-2*o&6)));return i},version:"0.1.0"};if(n&&!n.nodeType)if(o)o.exports=h;else for(var p in h)h.hasOwnProperty(p)&&(n[p]=h[p]);else r.base64=h})(f)}));function S(t){var e="";if("string"===typeof t)e=t;else for(var r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return A.encode(e)}function j(t,e,r,o,i,a,c){void 0===c&&(c=function(){}),void 0===a&&(a="png"),a=function(t){t=t.toLowerCase().replace(/jpg/i,"jpeg");var e=t.match(/png|jpeg|bmp|gif/)[0];return"image/"+e}(a),/bmp/.test(a)?function(t,e,r,n,o,i){uni.canvasGetImageData({canvasId:t,x:e,y:r,width:n,height:o,success:function(t){i(t,null)},fail:function(t){i(null,t)}})}(t,e,r,o,i,(function(t,e){var r=function(t){var e=t.width,r=t.height,n=e*r*3,o=n+54,i=[66,77,255&o,o>>8&255,o>>16&255,o>>24&255,0,0,0,0,54,0,0,0],a=[40,0,0,0,255&e,e>>8&255,e>>16&255,e>>24&255,255&r,r>>8&255,r>>16&255,r>>24&255,1,0,24,0,0,0,0,0,255&n,n>>8&255,n>>16&255,n>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c=(4-3*e%4)%4,u=t.data,s="",d=e<<2,h=r,p=String.fromCharCode;do{for(var f=d*(h-1),l="",g=0;g<e;g++){var v=g<<2;l+=p(u[f+v+2])+p(u[f+v+1])+p(u[f+v])}for(var w=0;w<c;w++)l+=String.fromCharCode(0);s+=l}while(--h);var b=S(i.concat(a))+S(s);return b}(t);v(c)&&c(function(t,e){return"data:"+e+";base64,"+t}(r,"image/"+a),e)})):n("error","暂不支持生成'"+a+"'类型的base64图片"," at GraceUI5/js/WeCropper.js:732")}var I={convertToImage:j,convertToBMP:function(t,e){void 0===t&&(t={});var r=t.canvasId,n=t.x,o=t.y,i=t.width,a=t.height;return void 0===e&&(e=function(){}),j(r,n,o,i,a,"bmp",e)}};var M={touchStart:function(t){var e=t.touches,n=e[0],o=e[1];this.src&&(r(this,!0,null,null),this.__oneTouchStart(n),t.touches.length>=2&&this.__twoTouchStart(n,o))},touchMove:function(t){var e=t.touches,n=e[0],o=e[1];this.src&&(r(this,null,!0),1===t.touches.length&&this.__oneTouchMove(n),t.touches.length>=2&&this.__twoTouchMove(n,o))},touchEnd:function(t){this.src&&(r(this,!1,!1,!0),this.__xtouchEnd())}};var W=function(t){var e={};return function(t,e){Object.defineProperties(t,e)}(this,d),Object.keys(d).forEach((function(t){e[t]=d[t].default})),Object.assign(this,e,t),this.prepare(),this.attachPage(),this.createCtx(),this.observer(),this.cutt(),this.methods(),this.init(),this.update(),this};return W.prototype.init=function(){var t=this.src;return this.version="1.3.9","function"===typeof this.onReady&&this.onReady(this.ctx,this),t?this.pushOrign(t):this.updateCanvas(),r(this,!1,!1,!1),this.oldScale=1,this.newScale=1,this},Object.assign(W.prototype,M),W.prototype.prepare=function(){var t=this;t.attachPage=function(){var e=getCurrentPages(),r=e[e.length-1];Object.defineProperty(r,"wecropper",{get:function(){return n("warn","Instance will not be automatically bound to the page after v1.4.0\n\nPlease use a custom instance name instead\n\nExample: \nthis.mycropper = new WeCropper(options)\n\n// ...\nthis.mycropper.getCropperImage()"," at GraceUI5/js/WeCropper.js:211"),t},configurable:!0})},t.createCtx=function(){var e=t.id,r=t.targetId;e?(t.ctx=t.ctx||uni.createCanvasContext(e),t.targetCtx=t.targetCtx||uni.createCanvasContext(r)):n("error","constructor: create canvas context failed, 'id' must be valuable"," at GraceUI5/js/WeCropper.js:233")},t.deviceRadio=p/750},W.prototype.observer=function(){var t=this;t.on=function(e,r){return b.indexOf(e)>-1?v(r)&&("ready"===e?r(t):t["on"+function(t){return t.charAt(0).toUpperCase()+t.slice(1)}(e)]=r):n("error","event: "+e+" is invalid"," at GraceUI5/js/WeCropper.js:348"),t}},W.prototype.methods=function(){var t=this,e=t.width,r=t.height,n=t.id,o=t.targetId,i=t.pixelRatio,a=t.cut,c=a.x;void 0===c&&(c=0);var u=a.y;void 0===u&&(u=0);var s=a.width;void 0===s&&(s=e);var d=a.height;void 0===d&&(d=r),t.updateCanvas=function(e){return t.croperTarget&&t.ctx.drawImage(t.croperTarget,t.imgLeft,t.imgTop,t.scaleWidth,t.scaleHeight),v(t.onBeforeDraw)&&t.onBeforeDraw(t.ctx,t),t.setBoundStyle(t.boundStyle),t.ctx.draw(!1,e),t},t.pushOrigin=t.pushOrign=function(e){return t.src=e,v(t.onBeforeImageLoad)&&t.onBeforeImageLoad(t.ctx,t),m({src:e}).then((function(e){var r=e.width/e.height,n=s/d;return t.croperTarget=e.path,r<n?(t.rectX=c,t.baseWidth=s,t.baseHeight=s/r,t.rectY=u-Math.abs((d-t.baseHeight)/2)):(t.rectY=u,t.baseWidth=d*r,t.baseHeight=d,t.rectX=c-Math.abs((s-t.baseWidth)/2)),t.imgLeft=t.rectX,t.imgTop=t.rectY,t.scaleWidth=t.baseWidth,t.scaleHeight=t.baseHeight,t.update(),new Promise((function(e){t.updateCanvas(e)}))})).then((function(){v(t.onImageLoad)&&t.onImageLoad(t.ctx,t)}))},t.removeImage=function(){return t.src="",t.croperTarget="",x(t.ctx)},t.getCropperBase64=function(t){void 0===t&&(t=function(){}),I.convertToBMP({canvasId:n,x:c,y:u,width:s,height:d},t)},t.getCropperImage=function(e,r){var a=e,h={canvasId:n,x:c,y:u,width:s,height:d,destWidth:s,destHeight:d},p=function(){return Promise.resolve()};return w(a)&&a.original&&(p=function(){return t.targetCtx.drawImage(t.croperTarget,t.imgLeft*i,t.imgTop*i,t.scaleWidth*i,t.scaleHeight*i),h={canvasId:o,x:c*i,y:u*i,width:s*i,height:d*i},x(t.targetCtx)}),p().then((function(){w(a)&&(h=Object.assign({},h,a)),v(a)&&(r=a);var t=h.componentContext?[h,h.componentContext]:[h];return C.apply(null,t)})).then((function(e){var n=e.tempFilePath;return v(r)?r.call(t,n,null):n})).catch((function(e){if(!v(r))throw e;r.call(t,null,e)}))}},W.prototype.cutt=function(){var t=this,e=t.width,r=t.height,n=t.cut,o=n.x;void 0===o&&(o=0);var i=n.y;void 0===i&&(i=0);var a=n.width;void 0===a&&(a=e);var c=n.height;void 0===c&&(c=r),t.outsideBound=function(e,r){t.imgLeft=e>=o?o:t.scaleWidth+e-o<=a?o+a-t.scaleWidth:e,t.imgTop=r>=i?i:t.scaleHeight+r-i<=c?i+c-t.scaleHeight:r},t.setBoundStyle=function(n){void 0===n&&(n={});var u=n.color;void 0===u&&(u="#04b00f");var s=n.mask;void 0===s&&(s="rgba(0, 0, 0, 0.3)");var d=n.lineWidth;void 0===d&&(d=1);var h=d/2,p=[{start:{x:o-h,y:i+10-h},step1:{x:o-h,y:i-h},step2:{x:o+10-h,y:i-h}},{start:{x:o-h,y:i+c-10+h},step1:{x:o-h,y:i+c+h},step2:{x:o+10-h,y:i+c+h}},{start:{x:o+a-10+h,y:i-h},step1:{x:o+a+h,y:i-h},step2:{x:o+a+h,y:i+10-h}},{start:{x:o+a+h,y:i+c-10+h},step1:{x:o+a+h,y:i+c+h},step2:{x:o+a-10+h,y:i+c+h}}];t.ctx.beginPath(),t.ctx.setFillStyle(s),t.ctx.fillRect(0,0,o,r),t.ctx.fillRect(o,0,a,i),t.ctx.fillRect(o,i+c,a,r-i-c),t.ctx.fillRect(o+a,0,e-o-a,r),t.ctx.fill(),p.forEach((function(e){t.ctx.beginPath(),t.ctx.setStrokeStyle(u),t.ctx.setLineWidth(d),t.ctx.moveTo(e.start.x,e.start.y),t.ctx.lineTo(e.step1.x,e.step1.y),t.ctx.lineTo(e.step2.x,e.step2.y),t.ctx.stroke()}))}},W.prototype.update=function(){var t=this;t.src&&(t.__oneTouchStart=function(e){t.touchX0=Math.round(e.x),t.touchY0=Math.round(e.y)},t.__oneTouchMove=function(e){var r,n;if(t.touchended)return t.updateCanvas();r=Math.round(e.x-t.touchX0),n=Math.round(e.y-t.touchY0);var o=Math.round(t.rectX+r),i=Math.round(t.rectY+n);t.outsideBound(o,i),t.updateCanvas()},t.__twoTouchStart=function(e,r){var n,o,i;t.touchX1=Math.round(t.rectX+t.scaleWidth/2),t.touchY1=Math.round(t.rectY+t.scaleHeight/2),n=Math.round(r.x-e.x),o=Math.round(r.y-e.y),i=Math.round(Math.sqrt(n*n+o*o)),t.oldDistance=i},t.__twoTouchMove=function(e,r){var n=t.oldScale,o=t.oldDistance,i=t.scale,a=t.zoom;t.newScale=function(t,e,r,n,o){var i,a,c;return i=Math.round(o.x-n.x),a=Math.round(o.y-n.y),c=Math.round(Math.sqrt(i*i+a*a)),t+.001*r*(c-e)}(n,o,a,e,r),t.newScale<=1&&(t.newScale=1),t.newScale>=i&&(t.newScale=i),t.scaleWidth=Math.round(t.newScale*t.baseWidth),t.scaleHeight=Math.round(t.newScale*t.baseHeight);var c=Math.round(t.touchX1-t.scaleWidth/2),u=Math.round(t.touchY1-t.scaleHeight/2);t.outsideBound(c,u),t.updateCanvas()},t.__xtouchEnd=function(){t.oldScale=t.newScale,t.rectX=t.imgLeft,t.rectY=t.imgTop})},W}))}).call(this,r("0de9")["log"],r("c8ba"))},cb29:function(t,e,r){var n=r("23e7"),o=r("81d5"),i=r("44d2");n({target:"Array",proto:!0},{fill:o}),i("fill")},df36:function(t,e,r){"use strict";r.r(e);var n=r("233a"),o=r.n(n);for(var i in n)["default"].indexOf(i)<0&&function(t){r.d(e,t,(function(){return n[t]}))}(i);e["default"]=o.a}}]);